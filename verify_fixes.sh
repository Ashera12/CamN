#!/bin/bash\n# CamN - System Diagnostic & Verification\n# Verify all fixes are properly applied\n\nBLUE='\\033[0;34m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nRED='\\033[0;31m'\nNC='\\033[0m'\n\nPASSED=0\nFAILED=0\n\necho -e \"${BLUE}╔════════════════════════════════════════════╗${NC}\"\necho -e \"${BLUE}║   CamN - System Diagnostic & Verification   ║${NC}\"\necho -e \"${BLUE}╚════════════════════════════════════════════╝${NC}\"\necho \"\"\n\ncheck_file() {\n    local file=$1\n    local description=$2\n    \n    if [ -f \"$file\" ]; then\n        echo -e \"${GREEN}✓${NC} $description\"\n        ((PASSED++))\n    else\n        echo -e \"${RED}✗${NC} $description - File not found: $file\"\n        ((FAILED++))\n    fi\n}\n\ncheck_content() {\n    local file=$1\n    local pattern=$2\n    local description=$3\n    \n    if grep -q \"$pattern\" \"$file\" 2>/dev/null; then\n        echo -e \"${GREEN}✓${NC} $description\"\n        ((PASSED++))\n    else\n        echo -e \"${RED}✗${NC} $description - Pattern not found in $file\"\n        ((FAILED++))\n    fi\n}\n\necho -e \"${YELLOW}=== File Structure Checks ===${NC}\"\necho \"\"\n\ncheck_file \"CamPhish/ip.php\" \"CamPhish IP capture script\"\ncheck_file \"CamPhish/post.php\" \"CamPhish camera posting handler\"\ncheck_file \"CamPhish/index.php\" \"CamPhish landing page\"\ncheck_file \"CamPhish/template.php\" \"CamPhish template\"\n\ncheck_file \"HACK-CAMERA/fest/post.php\" \"HACK-CAMERA Festival post handler\"\ncheck_file \"HACK-CAMERA/jio/post.php\" \"HACK-CAMERA Jio post handler\"\ncheck_file \"HACK-CAMERA/live/post.php\" \"HACK-CAMERA Live post handler\"\ncheck_file \"HACK-CAMERA/om/post.php\" \"HACK-CAMERA Meeting post handler\"\n\necho \"\"\necho -e \"${YELLOW}=== IP Logging Fixes ===${NC}\"\necho \"\"\n\ncheck_content \"CamPhish/ip.php\" \"json_encode\" \"JSON logging implemented\"\ncheck_content \"CamPhish/ip.php\" \"ip.json\" \"JSON file creation\"\ncheck_content \"CamPhish/ip.php\" \"Y-m-d H:i:s\" \"Timestamp format added\"\ncheck_content \"CamPhish/ip.php\" \"=\" \"Separator borders added\"\n\necho \"\"\necho -e \"${YELLOW}=== Camera Capture Logging Fixes ===${NC}\"\necho \"\"\n\ncheck_content \"CamPhish/post.php\" \"Y-m-d H:i:s\" \"Timestamp in post.php\"\ncheck_content \"CamPhish/post.php\" \"captures.json\" \"JSON capture tracking\"\ncheck_content \"CamPhish/post.php\" \"size_bytes\" \"File size tracking\"\ncheck_content \"CamPhish/post.php\" \"FILE_APPEND\" \"Proper file append mode\"\n\necho \"\"\necho -e \"${YELLOW}=== Redirect & Preview Mode ===${NC}\"\necho \"\"\n\ncheck_content \"CamPhish/index.php\" \"?debug\" \"Debug parameter check\"\ncheck_content \"CamPhish/index.php\" \"header.*Location\" \"Redirect functionality\"\ncheck_content \"CamPhish/index.php\" \"Link Active\" \"Preview page content\"\n\necho \"\"\necho -e \"${YELLOW}=== HACK-CAMERA Consistency ===${NC}\"\necho \"\"\n\nfor dir in fest jio live om; do\n    check_content \"HACK-CAMERA/$dir/post.php\" \"json_encode\" \"JSON logging in $dir\"\n    check_content \"HACK-CAMERA/$dir/post.php\" \"captures.json\" \"Capture tracking in $dir\"\ndone\n\necho \"\"\necho -e \"${YELLOW}=== Documentation Files ===${NC}\"\necho \"\"\n\ncheck_file \"FIX_DOCUMENTATION.md\" \"Fix documentation\"\ncheck_file \"QUICK_START_FIXES.md\" \"Quick start guide\"\ncheck_file \"log_monitor.sh\" \"Log monitoring script\"\n\necho \"\"\necho -e \"${YELLOW}=== PHP Syntax Validation ===${NC}\"\necho \"\"\n\nif command -v php &> /dev/null; then\n    for phpfile in CamPhish/*.php HACK-CAMERA/*/*.php; do\n        if php -l \"$phpfile\" 2>/dev/null | grep -q \"No syntax errors\"; then\n            echo -e \"${GREEN}✓${NC} Syntax OK: $phpfile\"\n            ((PASSED++))\n        else\n            echo -e \"${RED}✗${NC} Syntax Error: $phpfile\"\n            ((FAILED++))\n        fi\n    done\nelse\n    echo -e \"${YELLOW}⚠${NC}  PHP not installed - skipping syntax check\"\nfi\n\necho \"\"\necho -e \"${YELLOW}=== Permission Checks ===${NC}\"\necho \"\"\n\nfor dir in CamPhish HACK-CAMERA/fest HACK-CAMERA/jio HACK-CAMERA/live HACK-CAMERA/om; do\n    if [ -d \"$dir\" ]; then\n        if [ -w \"$dir\" ]; then\n            echo -e \"${GREEN}✓${NC} Writable: $dir\"\n            ((PASSED++))\n        else\n            echo -e \"${RED}✗${NC} Not writable: $dir (run: chmod 755 $dir)\"\n            ((FAILED++))\n        fi\n    fi\ndone\n\necho \"\"\necho -e \"${YELLOW}=== Feature Verification ===${NC}\"\necho \"\"\n\necho -e \"${GREEN}Features Implemented:${NC}\"\necho \"  ✓ Structured IP logging with timestamps\"\necho \"  ✓ JSON format for machine parsing\"\necho \"  ✓ Camera capture tracking with file size\"\necho \"  ✓ Preview mode with ?debug parameter\"\necho \"  ✓ Consistent logging across all versions\"\necho \"  ✓ Error handling improvements\"\necho \"  ✓ Monitoring scripts and documentation\"\n\necho \"\"\necho -e \"${YELLOW}=== Summary ===${NC}\"\necho \"\"\necho -e \"${GREEN}Passed:${NC} $PASSED\"\necho -e \"${RED}Failed:${NC} $FAILED\"\necho \"\"\n\nif [ $FAILED -eq 0 ]; then\n    echo -e \"${GREEN}╔════════════════════════════════════════╗${NC}\"\n    echo -e \"${GREEN}║  ✓ ALL CHECKS PASSED - SYSTEM READY     ║${NC}\"\n    echo -e \"${GREEN}╚════════════════════════════════════════╝${NC}\"\n    exit 0\nelse\n    echo -e \"${RED}╔════════════════════════════════════════╗${NC}\"\n    echo -e \"${RED}║  ✗ SOME CHECKS FAILED - SEE ABOVE      ║${NC}\"\n    echo -e \"${RED}╚════════════════════════════════════════╝${NC}\"\n    exit 1\nfi\n